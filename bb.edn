{:paths ["src"]
 :deps {org.clojure/clojure {:mvn/version "1.12.4"}}
 :tasks
 {:require [[clojure.string :as str]]

  test {:doc "Run the test suite."
        :task (clojure "-M:test" "-m" "cognitect.test-runner")}

  test:bb {:doc "Run the test suite using Babashka to check compatibility."
           :extra-paths ["test"]
           :extra-deps  {io.github.cognitect-labs/test-runner {:git/tag "v0.5.1" :git/sha "dfb30dd"}}
           :task (exec 'cognitect.test-runner.api/test)}

  test:all {:doc "Run the test suite with both Clojure and Babashka."
            :depends [test test:bb]}

  fmt {:doc "Format all Clojure files."
       :task (clojure "-M:fmt" "fix" "src" "test" "examples")}

  fmt:check {:doc "Check formatting without modifying files."
             :task (clojure "-M:fmt" "check" "src" "test" "examples")}

  docs {:doc "Generate API documentation with codox."
        :task (clojure "-X:codox")}

  jar {:doc "Build the JAR and POM."
       :task (clojure "-T:build" "jar")}

  readme:sha {:doc "Update README git dependency SHA to HEAD."
              :task (clojure "-T:build" "update-readme-sha")}

  ci {:doc "Run the CI pipeline of tests and build the JAR."
      :depends [test:all]
      :task (clojure "-T:build" "jar")}

  ci:deploy {:doc "Run the CI pipeline and deploy to Maven Central."
             :depends [ci]
             :task (clojure "-T:build" "deploy-central")}

  install {:doc "Install the JAR locally (build via ci)."
           :task (clojure "-T:build" "install")}

  validate-docs {:doc "Validate documentation: links, code blocks, and structure."
                 :task (shell "bb" "script/validate_docs.clj")}}}
