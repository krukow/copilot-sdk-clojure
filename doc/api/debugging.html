<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>MCP Server Debugging Guide</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name"></span> <span class="project-version"></span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="API.html"><div class="inner"><span>API Reference</span></div></a></li><li class="depth-1 "><a href="byok.html"><div class="inner"><span>BYOK (Bring Your Own Key)</span></div></a></li><li class="depth-1  current"><a href="debugging.html"><div class="inner"><span>MCP Server Debugging Guide</span></div></a></li><li class="depth-1 "><a href="getting-started.html"><div class="inner"><span>Getting Started with the Copilot SDK for Clojure</span></div></a></li><li class="depth-1 "><a href="index.html"><div class="inner"><span>Authentication</span></div></a></li><li class="depth-1 "><a href="index.html"><div class="inner"><span>Documentation</span></div></a></li><li class="depth-1 "><a href="overview.html"><div class="inner"><span>Using MCP Servers with the Copilot SDK for Clojure</span></div></a></li><li class="depth-1 "><a href="style.html"><div class="inner"><span>Documentation Style Guide</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>github</span></div></div></li><li class="depth-2"><a href="github.copilot-sdk.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>copilot-sdk</span></div></a></li><li class="depth-3 branch"><a href="github.copilot-sdk.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-3 branch"><a href="github.copilot-sdk.helpers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>helpers</span></div></a></li><li class="depth-3 branch"><a href="github.copilot-sdk.instrument.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>instrument</span></div></a></li><li class="depth-3 branch"><a href="github.copilot-sdk.logging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logging</span></div></a></li><li class="depth-3 branch"><a href="github.copilot-sdk.process.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>process</span></div></a></li><li class="depth-3 branch"><a href="github.copilot-sdk.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-3 branch"><a href="github.copilot-sdk.session.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>session</span></div></a></li><li class="depth-3 branch"><a href="github.copilot-sdk.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-3 branch"><a href="github.copilot-sdk.tools.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tools</span></div></a></li><li class="depth-3"><a href="github.copilot-sdk.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#mcp-server-debugging-guide" id="mcp-server-debugging-guide"></a>MCP Server Debugging Guide</h1>
<p>This guide covers debugging techniques specific to MCP (Model Context Protocol) servers when using the Copilot SDK for Clojure.</p>
<h2><a href="#quick-diagnostics" id="quick-diagnostics"></a>Quick Diagnostics</h2>
<h3><a href="#checklist" id="checklist"></a>Checklist</h3>
<p>Before diving deep, verify these basics:</p>
<ul>
<li>[ ] MCP server executable exists and is runnable</li>
<li>[ ] Command path is correct (use absolute paths when in doubt)</li>
<li>[ ] Tools are enabled (<code>:mcp-tools ["*"]</code> or specific tool names)</li>
<li>[ ] Server implements MCP protocol correctly (responds to <code>initialize</code>)</li>
<li>[ ] No firewall blocking the process</li>
</ul>
<h3><a href="#enable-debug-logging" id="enable-debug-logging"></a>Enable Debug Logging</h3>
<p>Use the client’s <code>:log-level :debug</code> to see MCP communication:</p>
<pre><code class="language-clojure">(copilot/with-client-session [{:log-level :debug}
                              session
                              {:model "gpt-5.2"
                               :mcp-servers {"my-server" {:mcp-command "/path/to/server"
                                                          :mcp-args []
                                                          :mcp-tools ["*"]}}}]
  ;; Debug output will show MCP initialization and tool calls
  (h/query "Use my tools" :session session))
</code></pre>
<p>You can also add environment variables to enable MCP server-side debugging:</p>
<pre><code class="language-clojure">{:mcp-command "/path/to/server"
 :mcp-args []
 :mcp-tools ["*"]
 :env {"MCP_DEBUG" "1"
       "DEBUG" "*"
       "NODE_DEBUG" "mcp"}}  ; For Node.js MCP servers
</code></pre>
<h2><a href="#testing-mcp-servers-independently" id="testing-mcp-servers-independently"></a>Testing MCP Servers Independently</h2>
<p>Always test your MCP server outside the SDK first.</p>
<h3><a href="#manual-protocol-test" id="manual-protocol-test"></a>Manual Protocol Test</h3>
<p>Send an <code>initialize</code> request via stdin:</p>
<pre><code class="language-bash">echo '{"jsonrpc":"2.0","id":1,"method":"initialize","params":{"protocolVersion":"2024-11-05","capabilities":{},"clientInfo":{"name":"test","version":"1.0"}}}' | /path/to/your/mcp-server
</code></pre>
<p><strong>Expected response:</strong></p>
<pre><code class="language-json">{"jsonrpc":"2.0","id":1,"result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{}},"serverInfo":{"name":"your-server","version":"1.0"}}}
</code></pre>
<h3><a href="#test-tool-listing" id="test-tool-listing"></a>Test Tool Listing</h3>
<p>After initialization, request the tools list:</p>
<pre><code class="language-bash">echo '{"jsonrpc":"2.0","id":2,"method":"tools/list","params":{}}' | /path/to/your/mcp-server
</code></pre>
<h3><a href="#interactive-testing-with-mcp-inspector" id="interactive-testing-with-mcp-inspector"></a>Interactive Testing with MCP Inspector</h3>
<p>Use the official MCP Inspector tool:</p>
<pre><code class="language-bash">npx @modelcontextprotocol/inspector /path/to/your/mcp-server
</code></pre>
<p>This provides a web UI to send test requests, view responses, and inspect tool schemas.</p>
<h2><a href="#common-issues" id="common-issues"></a>Common Issues</h2>
<h3><a href="#server-not-starting" id="server-not-starting"></a>Server Not Starting</h3>
<p><strong>Symptoms:</strong> No tools appear, no errors in logs.</p>
<table>
<thead>
<tr><th> Cause </th><th> Solution </th></tr>
</thead>
<tbody>
<tr><td> Wrong command path </td><td> Use absolute path: <code>/usr/local/bin/server</code> </td></tr>
<tr><td> Missing executable permission </td><td> <code>chmod +x /path/to/server</code> </td></tr>
<tr><td> Missing dependencies </td><td> Check with <code>ldd</code> (Linux) or run manually </td></tr>
<tr><td> Working directory issues </td><td> Set <code>:cwd</code> in config </td></tr>
</tbody>
</table>
<p><strong>Debug by running manually:</strong></p>
<pre><code class="language-bash">cd /expected/working/dir
/path/to/command arg1 arg2
</code></pre>
<h3><a href="#server-starts-but-tools-dont-appear" id="server-starts-but-tools-dont-appear"></a>Server Starts But Tools Don’t Appear</h3>
<ol>
<li><strong>Tools not enabled:</strong></li>
</ol>
<pre><code class="language-clojure">{:mcp-tools ["*"]}  ; Must be ["*"] or list of tool names
</code></pre>
<ol>
<li>
<p><strong>Server doesn’t expose tools:</strong> Test with <code>tools/list</code> request manually.</p>
</li>
<li>
<p><strong>Initialization handshake fails:</strong> Server must respond to <code>initialize</code> correctly and handle <code>notifications/initialized</code>.</p>
</li>
</ol>
<h3><a href="#tools-listed-but-never-called" id="tools-listed-but-never-called"></a>Tools Listed But Never Called</h3>
<ol>
<li><strong>Prompt doesn’t clearly need the tool:</strong></li>
</ol>
<pre><code class="language-clojure">;; Too vague
{:prompt "What's the weather?"}

;; Better - explicitly mentions capability
{:prompt "Use the weather tool to get the current temperature in Seattle"}
</code></pre>
<ol>
<li><strong>Tool description unclear:</strong></li>
</ol>
<pre><code class="language-clojure">;; Bad - model doesn't know when to use it
{:description "Does a thing"}

;; Good - clear purpose
{:description "Get current weather conditions for a city. Returns temperature, humidity, and conditions."}
</code></pre>
<ol>
<li><strong>Tool schema issues:</strong> Ensure <code>inputSchema</code> is valid JSON Schema with <code>required</code> fields.</li>
</ol>
<h3><a href="#timeout-errors" id="timeout-errors"></a>Timeout Errors</h3>
<ol>
<li><strong>Increase timeout:</strong></li>
</ol>
<pre><code class="language-clojure">{:mcp-command "slow-server"
 :mcp-args []
 :mcp-tools ["*"]
 :mcp-timeout 300000}  ; 5 minutes
</code></pre>
<ol>
<li><strong>Optimize server performance:</strong> Add progress logging, check for blocking I/O.</li>
</ol>
<h3><a href="#json-rpc-errors" id="json-rpc-errors"></a>JSON-RPC Errors</h3>
<p>Common causes:</p>
<ol>
<li><strong>Server writes debug output to stdout instead of stderr:</strong></li>
</ol>
<pre><code class="language-javascript">// Wrong - pollutes stdout
console.log("Debug info");

// Correct - use stderr
console.error("Debug info");
</code></pre>
<ol>
<li>
<p><strong>Encoding issues:</strong> Ensure UTF-8 encoding, no BOM.</p>
</li>
<li>
<p><strong>Message framing:</strong> Each message must be a complete JSON object, newline-delimited.</p>
</li>
</ol>
<h2><a href="#platform-specific-issues" id="platform-specific-issues"></a>Platform-Specific Issues</h2>
<h3><a href="#macos" id="macos"></a>macOS</h3>
<p><strong>Gatekeeper blocking:</strong></p>
<pre><code class="language-bash">xattr -d com.apple.quarantine /path/to/mcp-server
</code></pre>
<p><strong>Homebrew paths:</strong> Use full paths when the CLI environment may not have Homebrew in PATH:</p>
<pre><code class="language-clojure">{:mcp-command "/opt/homebrew/bin/node"
 :mcp-args ["/path/to/server.js"]
 :mcp-tools ["*"]}
</code></pre>
<h3><a href="#linux" id="linux"></a>Linux</h3>
<p><strong>Permission issues:</strong></p>
<pre><code class="language-bash">chmod +x /path/to/mcp-server
</code></pre>
<p><strong>Missing shared libraries:</strong></p>
<pre><code class="language-bash">ldd /path/to/mcp-server
</code></pre>
<h2><a href="#advanced-debugging" id="advanced-debugging"></a>Advanced Debugging</h2>
<h3><a href="#capture-all-mcp-traffic" id="capture-all-mcp-traffic"></a>Capture All MCP Traffic</h3>
<p>Create a wrapper script to log all communication:</p>
<pre><code class="language-bash">#!/bin/bash
# mcp-debug-wrapper.sh
LOG="/tmp/mcp-debug-$(date +%s).log"
echo "=== MCP Debug Session ===" &gt;&gt; "$LOG"
tee -a "$LOG" | "$1" "${@:2}" 2&gt;&gt; "$LOG" | tee -a "$LOG"
</code></pre>
<p>Use it:</p>
<pre><code class="language-clojure">{:mcp-command "/path/to/mcp-debug-wrapper.sh"
 :mcp-args ["/actual/server/path" "arg1" "arg2"]
 :mcp-tools ["*"]}
</code></pre>
<h3><a href="#monitoring-mcp-events-in-clojure" id="monitoring-mcp-events-in-clojure"></a>Monitoring MCP Events in Clojure</h3>
<p>Subscribe to tool execution events to observe MCP tool calls:</p>
<pre><code class="language-clojure">(require '[clojure.core.async :refer [chan tap go-loop &lt;!]])

(copilot/with-client-session [session {:model "gpt-5.2"
                                       :mcp-servers {"my-server" {:mcp-command "server"
                                                                   :mcp-args []
                                                                   :mcp-tools ["*"]}}}]
  (let [ch (chan 256)]
    (tap (copilot/events session) ch)
    (go-loop []
      (when-let [event (&lt;! ch)]
        (case (:type event)
          :copilot/tool.execution_start
          (println "MCP tool called:" (get-in event [:data :tool-name])
                   "args:" (get-in event [:data :arguments]))

          :copilot/tool.execution_complete
          (println "MCP tool completed:" (get-in event [:data :tool-call-id])
                   "success:" (get-in event [:data :success?]))
          nil)
        (recur)))
    (copilot/send-and-wait! session {:prompt "Use my tools"})))
</code></pre>
<h2><a href="#debugging-checklist" id="debugging-checklist"></a>Debugging Checklist</h2>
<p>When opening an issue or asking for help, collect:</p>
<ul>
<li>[ ] SDK version (check <code>deps.edn</code> or <code>pom.xml</code>)</li>
<li>[ ] CLI version (<code>copilot --version</code>)</li>
<li>[ ] MCP server type (Node.js, Python, Go, etc.)</li>
<li>[ ] Full MCP server configuration (redact secrets)</li>
<li>[ ] Result of manual <code>initialize</code> test</li>
<li>[ ] Result of manual <code>tools/list</code> test</li>
<li>[ ] Debug logs from SDK (<code>:log-level :debug</code>)</li>
<li>[ ] Any error messages</li>
</ul>
<h2><a href="#see-also" id="see-also"></a>See Also</h2>
<ul>
<li><a href="./overview.html">MCP Overview</a> — Configuration and setup</li>
<li><a href="https://modelcontextprotocol.io/">MCP Specification</a> — Official protocol docs</li>
<li><a href="https://github.com/modelcontextprotocol/servers">MCP Servers Directory</a> — Community MCP servers</li>
</ul>
</div></div></div></body></html>